
tags: [[四种IO控制方式]]


我们一个一个地来，先从最核心的概念——**中断**开始。

## 1. 中断（Interrupt）

你可以把“中断”想象成你正在专心做某件事，突然有人打断了你。你放下手头的工作，去处理那个打断你的事情，处理完之后再回来继续做之前的事情。

- **定义：** 中断就是计算机在正常执行程序的过程中，突然发生了某个事件（比如有人按了键盘，或者打印机没纸了），CPU 暂时停下手头的工作，去处理这个突发事件，处理完之后再回来继续执行原来的程序。
- **关键点：**
    - **突发事件：** 中断的发生通常是不可预测的，可能是外部设备发出的请求，也可能是 CPU 内部产生的错误。
    - **暂时停止：** CPU 会暂停当前程序的执行，但不会终止它。
    - **处理事件：** CPU 会跳转到一段特定的程序去处理中断事件。
    - **恢复执行：** 处理完成后，CPU 会回到之前暂停的程序，从中断发生的位置继续执行。

## 2. 中断源（Interrupt Source）

现在我们知道中断是“有人打断你”，那“谁来打断你”呢？这个“谁”就是中断源。

- **定义：** 中断源就是引起中断的事件或设备。
- **分类：**
    - **外部中断：** 就像“有人按了键盘”或“打印机没纸了”，这是由计算机外部的设备发出的中断请求。
    - **内部中断：** 就像你在工作中突然发现“咖啡没了”，这是 CPU 内部产生的中断请求，比如程序运行时出现了错误（除法错误、溢出等）。

## 3. 中断处理程序（Interrupt Handler）

“有人打断你”之后，你总得“去处理”吧？“处理”这件事就是由**中断处理程序**来完成的。

- **定义：** 中断处理程序是当发生中断时，CPU 执行的一段特定的程序，专门用于处理该中断事件。
- **功能：**
    - **保存现场信息：** 就像你“放下手头的工作”，得先“记住”你做到哪儿了，这样才能回来接着做。中断处理程序也会先保存 CPU 的一些重要信息（比如寄存器里的数据、程序执行到哪里了），这样处理完中断后才能回到原来的程序。
    - **执行中断处理逻辑：** 这就是“去处理”的具体内容，比如键盘中断就去读取按键信息，打印机中断就去检查打印机状态。
    - **恢复现场信息：** 处理完中断后，把之前“记住”的信息恢复，让 CPU 回到中断发生前的状态。
    - **返回：** 回到原来的程序，继续执行。

好的，我们继续介绍与中断向量相关的概念。

## 4. 中断向量（Interrupt Vector）

现在我们知道中断发生时，需要去执行一段特定的程序（中断处理程序）。那么，CPU 怎么知道这段程序在哪里呢？这就需要用到**中断向量**了。

- **定义：** 中断向量可以看作是一个“路标”，它指向中断处理程序的入口地址。就像你在地图上找到一个目的地的坐标，这个坐标就相当于中断向量，它告诉你中断处理程序的位置。
- **形式：** 中断向量通常是一个数字，不同的中断源对应不同的中断向量。这个数字就像一个“编号”，CPU 通过这个编号就能找到对应的“路标”。

## 5. 中断向量表（Interrupt Vector Table）

有了“路标”，还得有个“地图”才行。这个“地图”就是**中断向量表**。

- **定义：** 中断向量表是一个存储中断向量和对应中断处理程序入口地址的表格。就像地图上有很多坐标，每个坐标都指向一个地点。
- **内容：** 中断向量表的每一项都包含一个中断向量和一个中断处理程序的入口地址。
- **作用：** CPU 通过查找中断向量表，根据中断向量找到对应的中断处理程序入口地址，然后跳转到该地址执行中断处理程序。

## 6. 向量中断（Vectored Interrupt）

现在我们把中断向量、“地图”和“路标”都介绍完了，就可以引出**向量中断**的概念了。

- **定义：** 向量中断是一种中断处理机制，它使用中断向量表来管理中断处理程序。就像你根据地图上的坐标找到目的地一样，CPU 根据中断向量在中断向量表中找到中断处理程序的入口地址。
- **工作方式：**
    1. **中断发生：** 当一个中断事件发生时，硬件会产生一个与该中断源对应的中断向量。
    2. **查找中断向量表：** CPU 使用这个中断向量作为索引，在中断向量表中找到对应的表项。
    3. **获取入口地址：** 从表项中取出中断处理程序的入口地址。
    4. **跳转执行：** CPU 跳转到该入口地址，开始执行中断处理程序。

## 逐步理解

通过以上介绍，相信你对中断向量、中断向量表和向量中断有了更清晰的认识。它们之间的关系就像“路标”、“地图”和“根据路标找地图上的地点”。

向量中断是现代计算机系统中常用的一种中断处理机制，它提高了中断处理的效率和灵活性。