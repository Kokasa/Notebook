![[Pasted image 20250216165835.png]]

```
假设这个系统中不考虑cache, 但是使用TLB, MMU会先将虚拟地址传递给TLB, TLB返回页表项, MMU查到物理地址之后访问主存, 如果未命中, 则MMU将页表项地址传递给主存, 主存将页表项传递给MMU和TLB
```

## TLB请求流程
- **CPU 发出请求：** CPU 生成包含虚拟地址的内存访问请求，并将其发送给 MMU。
    
- **MMU 查找 TLB：** MMU 接收到虚拟地址后，首先在 TLB 中查找该地址对应的页表项。
    
- **TLB 命中：** 如果 TLB 中找到了对应的页表项，则 TLB 将页表项返回给 MMU，MMU 根据页表项中的信息将虚拟地址转换为物理地址，并访问主存。
    
- **TLB 未命中：** 如果 TLB 中没有找到对应的页表项，则 MMU 向主存发出请求，读取包含该虚拟地址的页表项。
    
- **主存返回页表项：** 主存根据 MMU 提供的页表项地址，找到相应的页表项，并将其返回给 MMU。
    
- **MMU 更新 TLB：** MMU 将从主存读取的页表项存储到 TLB 中，以便下次访问该地址时可以直接从 TLB 中获取，提高访问速度。
    
- **MMU 进行地址转换：** MMU 根据从主存获取的页表项，将虚拟地址转换为物理地址，并访问主存。
    
- **缺页处理：** 如果 MMU 在页表中找不到与虚拟地址对应的页表项，则会触发缺页中断。MMU 会调用缺页处理程序，将缺失的页从硬盘加载到主存中，并更新页表和 TLB。然后，MMU 会重新进行地址转换和数据访问。

## 关键

- **TLB 加速地址转换：** TLB 是一种高速缓存，用于存储最近使用的页表项，从而加速地址转换过程。
- **TLB 未命中：** 当 TLB 未命中时，MMU 需要访问主存中的页表，并将读取的页表项存储到 TLB 中。
- **TLB 更新：** MMU 会在 TLB 未命中时，以及发生缺页中断时，更新 TLB 中的内容。

## 补充

- **TLB 容量：** TLB 的容量通常比主存小得多，但访问速度却快得多。
- **TLB 替换算法：** 当 TLB 空间不足时，需要选择一个页表项进行替换。常见的替换算法有 LRU（最近最少使用）、FIFO（先进先出）等。
- **多级 TLB：** 现代计算机系统有时会使用多级 TLB，例如 L1 TLB、L2 TLB 等。不同级别的 TLB 具有不同的容量和访问速度。